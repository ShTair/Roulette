@page "/env"
@inject IJSRuntime JS
@inject NavigationManager Nav
@using Roulette.Models

<PageTitle>環境設定 - ルーレット</PageTitle>

<h3>環境設定</h3>

<div class="mb-3">
    <label class="form-label">減速開始までの最小時間 (秒)</label>
    <input type="number" step="0.1" min="0" class="form-control" @bind="settings.AutoStopDelayMinSeconds" />
    <div class="form-text">この時間経過後に、1周未満のランダムな時間回転したのち、減速を開始します。</div>
</div>
<div class="mb-3">
    <label class="form-label">減速開始から完全に止まるまでの時間 (秒)</label>
    <input type="number" step="0.1" min="0.1" class="form-control" @bind="settings.StopDurationSeconds" />
</div>
<div class="mb-3">
    <label class="form-label">回転速度 (ラジアン/秒)</label>
    <input type="number" step="0.1" min="0.1" class="form-control" @bind="settings.StartSpeed" />
</div>
<div class="mb-3">
    <label class="form-label">ルーレット盤の枠線の色</label>
    <input type="color" class="form-control form-control-color" @bind="settings.BorderColor" />
</div>
<div class="mb-3 form-check form-switch">
    <input class="form-check-input" type="checkbox" id="idleSpinToggle" @bind="settings.IdleSpin" />
    <label class="form-check-label" for="idleSpinToggle">待機中も盤を回転させる</label>
</div>
<div class="mb-3 form-check form-switch">
    <input class="form-check-input" type="checkbox" id="autoFontToggle" @bind="settings.AutoFontSize" />
    <label class="form-check-label" for="autoFontToggle">項目の文字量に応じてフォントサイズを自動調整する</label>
</div>

<div class="mb-3 d-flex">
    <button class="btn btn-warning me-auto" @onclick="Reset">デフォルトに戻す</button>
    <button class="btn btn-primary ms-auto" @onclick="Save">保存</button>
    <button class="btn btn-secondary ms-2" @onclick="Back">戻る</button>
</div>

@code {
    private AppSettings settings = new();

    protected override async Task OnInitializedAsync()
    {
        settings = await AppSettings.LoadAsync(JS);
    }

    private void Reset()
    {
        settings = new AppSettings();
    }

    private async Task Save()
    {
        await AppSettings.SaveAsync(JS, settings);
        Nav.NavigateTo("");
    }

    private void Back()
    {
        Nav.NavigateTo("");
    }
}
